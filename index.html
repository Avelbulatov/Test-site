<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Единство. Доблесть. Технологии. Татарстан</title>
    <!-- Флаг Татарстана в иконке сайта (favicon) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='33.3' fill='%23007A3D'/%3E%3Crect y='33.3' width='100' height='33.3' fill='%23FFFFFF'/%3E%3Crect y='66.6' width='100' height='33.4' fill='%23D52B1E'/%3E%3C/svg%3E">
    <style>
        /* Базовые стили */
        * {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Контрастный режим */
        body.contrast {
            background-color: black;
            color: yellow;
        }
        body.contrast button {
            background-color: yellow;
            color: black;
            border: 2px solid white;
        }
        body.contrast .subtitle {
            background-color: black;
            color: yellow;
            border-color: yellow;
        }
        /* Крупный текст */
        body.large-text {
            font-size: 1.5em;
        }
        body.large-text button {
            font-size: 1.2em;
            padding: 15px 20px;
        }
        .header {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .accessibility-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        button {
            padding: 12px 24px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            min-width: 150px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:focus-visible {
            outline: 3px solid #ff8c00;
            outline-offset: 2px;
        }
        .page {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        body.contrast .page {
            background: black;
            border: 2px solid yellow;
        }
        .page.active {
            display: block;
        }
        .page-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        .page-text {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 30px;
            white-space: pre-line;
        }
        .nav-button {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 10px auto;
            background-color: #008CBA;
        }
        .nav-button:hover {
            background-color: #007bb5;
        }
        .subtitle {
            padding: 15px;
            background-color: #eee;
            border: 2px solid #aaa;
            border-radius: 10px;
            font-size: 1.2em;
            text-align: left;
            margin-top: 20px;
            min-height: 70px;
        }
        .footer {
            margin-top: auto;
        }
        .main-menu-button {
            background-color: #f44336;
        }
        .main-menu-button:hover {
            background-color: #da190b;
        }
        .voice-active {
            background-color: #ffaa00;
            color: black;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="header">Подвиги и достижения народов Татарстана</div>

    <!-- Панель доступности (все кнопки добавлены) -->
    <div class="accessibility-panel">
        <button id="contrastBtn">Контрастный режим</button>
        <button id="largeFontBtn">Крупный текст</button>
        <button id="screenReaderBtn">Экранный диктор (вкл)</button>
        <button id="subtitlesBtn">Субтитры</button>
        <button id="signBtn">Сурдоперевод</button>
        <button id="voiceControlBtn">Голосовое управление</button>
    </div>

    <!-- Контейнер страниц (стек) -->
    <div id="pageStack">
        <!-- Главная страница -->
        <div id="mainPage" class="page active">
            <div class="page-title">Главное меню</div>
            <button class="nav-button" data-page="past">Подвиги прошлого</button>
            <button class="nav-button" data-page="present">Современность</button>
            <button class="nav-button" data-page="connection">Связь поколений</button>
            <button class="nav-button" data-page="about">О проекте</button>
        </div>

        <!-- Страница "Подвиги прошлого" -->
        <div id="pastPage" class="page">
            <div class="page-title">Подвиги прошлого</div>
            <div class="page-text">
                В годы Великой Отечественной войны труженики Татарстана отправляли на фронт технику,
                продовольствие и тёплые вещи. Казанский авиационный завод выпускал самолёты Пе-2,
                Ту-2. Рабочие дни длились по 12-14 часов. Многие уходили добровольцами на фронт
                и совершали героические подвиги. Единство народов республики помогло выстоять.
            </div>
            <button class="nav-button main-menu-button" data-page="main">На главную</button>
        </div>

        <!-- Страница "Современность" -->
        <div id="presentPage" class="page">
            <div class="page-title">Современные достижения</div>
            <div class="page-text">
                Сегодня Татарстан — один из лидеров инноваций в России. КАМАЗ, «Алабуга»,
                IT-парк, новые технологии в нефтехимии. Молодые специалисты продолжают традиции
                трудовой доблести. Республика славится межнациональным миром и согласием.
            </div>
            <button class="nav-button main-menu-button" data-page="main">На главную</button>
        </div>

        <!-- Страница "Связь поколений" -->
        <div id="connectionPage" class="page">
            <div class="page-title">Связь поколений</div>
            <div class="page-text">
                Дух единства и доблести, рождённый в суровые годы, живёт и сегодня.
                Ветераны передают опыт молодёжи, создаются поисковые отряды,
                сохраняется память о героях. Трудовые династии работают на заводах,
                молодые инженеры разрабатывают новые технологии, опираясь на наследие предков.
            </div>
            <button class="nav-button main-menu-button" data-page="main">На главную</button>
        </div>

        <!-- Страница "О проекте" -->
        <div id="aboutPage" class="page">
            <div class="page-title">О проекте</div>
            <div class="page-text">
                Проект «Единство. Доблесть. Технологии. Доступно каждому» создан, чтобы рассказать
                о подвигах и достижениях народов Татарстана.

                Функции доступности:
                • Экранный диктор (озвучивание кнопок при Tab, чтение текста страниц)
                • Субтитры
                • Контрастный режим
                • Крупный текст
                • Голосовое управление
            </div>
            <button class="nav-button main-menu-button" data-page="main">На главную</button>
        </div>
    </div>

    <!-- Субтитры -->
    <div class="subtitle" id="subtitleDisplay">Субтитры: Добро пожаловать</div>

    <script>
        (function() {
            // Состояния
            let screenReaderEnabled = true;
            let contrastMode = false;
            let largeTextMode = false;

            // Элементы
            const pages = {
                main: document.getElementById('mainPage'),
                past: document.getElementById('pastPage'),
                present: document.getElementById('presentPage'),
                connection: document.getElementById('connectionPage'),
                about: document.getElementById('aboutPage')
            };

            const subtitleEl = document.getElementById('subtitleDisplay');
            const screenReaderBtn = document.getElementById('screenReaderBtn');
            const contrastBtn = document.getElementById('contrastBtn');
            const largeFontBtn = document.getElementById('largeFontBtn');
            const subtitlesBtn = document.getElementById('subtitlesBtn');
            const signBtn = document.getElementById('signBtn');
            const voiceControlBtn = document.getElementById('voiceControlBtn');

            // Все кнопки на странице (для фокуса)
            let allButtons = [];

            // Обновление списка кнопок (вызывается при загрузке и после изменений)
            function refreshButtonsList() {
                allButtons = Array.from(document.querySelectorAll('button'));
            }

            // --- Синтез речи (озвучивание) ---
            function speakText(text) {
                console.log('Озвучивание:', text);
                if (!screenReaderEnabled) return;
                if (!window.speechSynthesis) {
                    console.warn('Речь не поддерживается');
                    return;
                }
                // Отмена предыдущей речи, чтобы не накладывалась
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ru-RU';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                window.speechSynthesis.speak(utterance);
            }

            // Обновление субтитров
            function updateSubtitles(message) {
                subtitleEl.textContent = 'Субтитры: ' + message;
            }

            // Переключение страницы
            function showPage(pageId) {
                // Скрываем все страницы
                Object.values(pages).forEach(page => page.classList.remove('active'));
                // Показываем нужную
                if (pages[pageId]) {
                    pages[pageId].classList.add('active');
                    // Если это не главная страница - озвучиваем текст страницы
                    if (pageId !== 'main') {
                        const textElement = pages[pageId].querySelector('.page-text');
                        if (textElement) {
                            const pageText = textElement.innerText;
                            speakText(pageText);
                            updateSubtitles('Страница: ' + pageId + '. ' + pageText.substring(0, 100) + '...');
                        }
                    } else {
                        updateSubtitles('Главное меню');
                    }
                    // Устанавливаем фокус на первую кнопку в странице
                    const firstButton = pages[pageId].querySelector('button');
                    if (firstButton) {
                        firstButton.focus();
                    }
                }
            }

            // --- Обработчик фокуса для озвучивания кнопок (Tab) ---
            function handleFocus(event) {
                const target = event.target;
                if (target.tagName === 'BUTTON' && screenReaderEnabled) {
                    speakText(target.textContent);
                    updateSubtitles('Фокус: ' + target.textContent);
                }
            }

            // --- Голосовое управление (SpeechRecognition) ---
            let recognition = null;
            let isListening = false;

            function initSpeechRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    alert('Голосовое управление не поддерживается вашим браузером.');
                    return null;
                }
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recog = new SpeechRecognition();
                recog.lang = 'ru-RU';
                recog.interimResults = false;
                recog.maxAlternatives = 1;
                return recog;
            }

            function startVoiceControl() {
                if (!recognition) {
                    recognition = initSpeechRecognition();
                    if (!recognition) return;
                }

                if (isListening) {
                    // Если уже слушаем, останавливаем
                    recognition.stop();
                    return;
                }

                // Настраиваем обработчики
                recognition.onstart = function() {
                    isListening = true;
                    voiceControlBtn.classList.add('voice-active');
                    updateSubtitles('Голосовое управление активно. Говорите команду...');
                    speakText('Слушаю команду');
                };

                recognition.onerror = function(event) {
                    console.warn('Ошибка распознавания:', event.error);
                    isListening = false;
                    voiceControlBtn.classList.remove('voice-active');
                    updateSubtitles('Ошибка голосового управления: ' + event.error);
                };

                recognition.onend = function() {
                    isListening = false;
                    voiceControlBtn.classList.remove('voice-active');
                    updateSubtitles('Голосовое управление завершено');
                };

                recognition.onresult = function(event) {
                    const last = event.results.length - 1;
                    const command = event.results[last][0].transcript.trim().toLowerCase();
                    updateSubtitles('Распознано: ' + command);
                    speakText('Команда: ' + command);
                    executeVoiceCommand(command);
                };

                // Запускаем
                try {
                    recognition.start();
                } catch (e) {
                    console.error('Не удалось запустить распознавание:', e);
                }
            }

            function executeVoiceCommand(command) {
                // Сопоставляем ключевые слова с действиями
                if (command.includes('главная') || command.includes('меню')) {
                    showPage('main');
                } else if (command.includes('подвиг') || command.includes('прошл')) {
                    showPage('past');
                } else if (command.includes('современ') || command.includes('сегодня')) {
                    showPage('present');
                } else if (command.includes('связь') || command.includes('поколен')) {
                    showPage('connection');
                } else if (command.includes('проект') || command.includes('о проекте')) {
                    showPage('about');
                } else if (command.includes('контраст')) {
                    contrastBtn.click();
                } else if (command.includes('крупн') || command.includes('шрифт')) {
                    largeFontBtn.click();
                } else if (command.includes('диктор') || command.includes('экранный')) {
                    screenReaderBtn.click();
                } else if (command.includes('субтитры')) {
                    subtitlesBtn.click();
                } else if (command.includes('сурдо') || command.includes('перевод')) {
                    signBtn.click();
                } else {
                    speakText('Команда не распознана');
                    updateSubtitles('Команда не распознана: ' + command);
                }
            }

            // --- Инициализация обработчиков ---

            // Глобальный слушатель фокуса
            document.addEventListener('focusin', handleFocus);

            // Навигация по кнопкам с атрибутом data-page
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('button[data-page]');
                if (btn) {
                    const page = btn.getAttribute('data-page');
                    showPage(page);
                }
            });

            // --- Кнопки доступности ---

            // Контрастный режим
            contrastBtn.addEventListener('click', () => {
                contrastMode = !contrastMode;
                document.body.classList.toggle('contrast', contrastMode);
                const msg = 'Контрастный режим ' + (contrastMode ? 'включён' : 'выключен');
                speakText(msg);
                updateSubtitles(msg);
            });

            // Крупный текст
            largeFontBtn.addEventListener('click', () => {
                largeTextMode = !largeTextMode;
                document.body.classList.toggle('large-text', largeTextMode);
                const msg = 'Крупный текст ' + (largeTextMode ? 'включён' : 'выключен');
                speakText(msg);
                updateSubtitles(msg);
            });

            // Экранный диктор
            screenReaderBtn.addEventListener('click', () => {
                screenReaderEnabled = !screenReaderEnabled;
                screenReaderBtn.textContent = 'Экранный диктор (' + (screenReaderEnabled ? 'вкл' : 'выкл') + ')';
                const msg = 'Экранный диктор ' + (screenReaderEnabled ? 'включён' : 'выключен');
                speakText(msg);
                updateSubtitles(msg);
            });

            // Субтитры (демо)
            subtitlesBtn.addEventListener('click', () => {
                const msg = 'Субтитры: тестовое сообщение';
                updateSubtitles('Тестовое сообщение');
                speakText('Субтитры обновлены');
            });

            // Сурдоперевод (демо)
            signBtn.addEventListener('click', () => {
                const msg = 'Открыт сурдоперевод';
                speakText(msg);
                updateSubtitles(msg);
            });

            // Голосовое управление
            voiceControlBtn.addEventListener('click', startVoiceControl);

            // Обновить список кнопок при загрузке
            refreshButtonsList();

            // Ставим фокус на первую кнопку главного меню после загрузки
            window.addEventListener('load', () => {
                const firstMainBtn = document.querySelector('#mainPage .nav-button');
                if (firstMainBtn) {
                    firstMainBtn.focus();
                }
                // Показываем главную страницу
                showPage('main');
                // Инициализируем синтез речи первым взаимодействием (чтобы избежать блокировки)
                document.body.addEventListener('click', function initSpeech() {
                    if (window.speechSynthesis) {
                        // Пустой utterance для разблокировки в некоторых браузерах
                        const utterance = new SpeechSynthesisUtterature('');
                        window.speechSynthesis.speak(utterance);
                    }
                    document.body.removeEventListener('click', initSpeech);
                }, { once: true });
            });

            // Дополнительно: при переходе на страницу с помощью кнопки "На главную" фокус уже устанавливается в showPage.
        })();
    </script>
</body>
</html>
